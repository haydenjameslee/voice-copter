var KEY={BACKSPACE:8,TAB:9,NUM_PAD_CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,SEMICOLON:59,WINDOWS_LEFT:91,WINDOWS_RIGHT:92,SELECT:93,NUM_PAD_ASTERISK:106,NUM_PAD_PLUS_SIGN:107,"NUM_PAD_HYPHEN-MINUS":109,NUM_PAD_FULL_STOP:110,NUM_PAD_SOLIDUS:111,NUM_LOCK:144,SCROLL_LOCK:145,EQUALS_SIGN:187,COMMA:188,"HYPHEN-MINUS":189,FULL_STOP:190,
SOLIDUS:191,GRAVE_ACCENT:192,LEFT_SQUARE_BRACKET:219,REVERSE_SOLIDUS:220,RIGHT_SQUARE_BRACKET:221,APOSTROPHE:222},context,analyser,backgroundNoise,canvas;(function(){for(var c=48;57>=c;c++)KEY[""+(c-48)]=c;for(c=65;90>=c;c++)KEY[""+String.fromCharCode(c)]=c;for(c=96;105>=c;c++)KEY["NUM_PAD_"+(c-96)]=c;for(c=112;123>=c;c++)KEY["F"+(c-112+1)]=c})();
var Heli={Consts:[{name:"State",consts:["WAITING","PAUSED","PLAYING","DYING","BACKGROUND"]},{name:"Dir",consts:["UP","DOWN"]}],FOOTER_HEIGHT:20,FPS:10,Color:{BACKGROUND:"#C3CCB5",BLOCK:"#403B37",HOME_TEXT:"#403B37",RAND_BLOCK:"#403B37",USER:"#FFFF00",TARGET_STROKE:"#B24524",DIALOG_TEXT:"#333333",FOOTER_BG:"#403B37",FOOTER_TEXT:"#C3CCB5"},User:function(c){function l(){return parseInt(localStorage.bestDistance||0,10)}var g=0,m=null,a=null,b=2;return{reset:function(){g=0;m=50;a=[];b=0},move:function(n){g+=
1;b+=n?0.4:-0.5;m+=b;0===c.tick()%2&&a.push(m);4<a.length&&a.shift();return m},trail:function(){return a},distance:function(){return g},finished:function(){var b=new Clay.Leaderboard({id:2638});if(g>l()&&100<g){localStorage.bestDistance=g;var c=prompt("Please enter your name",""),a={html:"",recent:3600,sort:"desc",filter:["day","month"],cumulative:!1,best:!1,limit:10,self:!1,friends:!1,showPersonal:!0};b.post({score:g,name:c},function(c){b.show(a,function(b){console.log(b)});console.log(c)})}},bestDistance:l}},
Screen:function(c){function l(e){return a-e/100*a}function g(e,b){return e+Math.floor(Math.random()*(b-e))}var m=c.width,a=c.height,b=Heli.Dir.UP,n=m/30,x=a/100,r=null,h=null,q=null,v=0,s=null,A=30/c.height*100,p=[],k=new Image,t=new Image;k.src="style/img/heli.png";t.src="style/img/heli2.png";return{draw:function(e){e.fillStyle=Heli.Color.BACKGROUND;e.fillRect(0,0,m,a);e.fill()},drawUser:function(e,b,f,a){f=Math.round(0.25*p.length);a=2>(a&&c.tick())%4?k:t;e.fillStyle=Heli.Color.USER;e.beginPath();
e.drawImage(a,f*n-40,l(b)-A/2);e.fill();e.closePath()},drawTerrain:function(e){e.fillStyle=Heli.Color.BLOCK;for(var b,f,c=0;30>c;c+=1)b=p[c],f=b.bottom,e.fillRect(Math.floor(c*n),0,Math.ceil(n),b.top*x),e.fillRect(Math.floor(c*n),a-f*x,Math.ceil(n),a);null!==h&&(b=l(s),e.fillStyle=Heli.Color.RAND_BLOCK,e.fillRect(h*n,b,n,b-l(s+20)))},moveTerrain:function(){var e,a=p[Math.round(p.length-1)];null===h?(e=Math.floor(50*Math.random()),0===c.tick()%e&&(h=30,s=g(a.bottom,100-a.top))):(h-=1,0>h&&(h=null));
0===v&&(b=b===Heli.Dir.DOWN?Heli.Dir.UP:Heli.Dir.DOWN,e=b===Heli.Dir.DOWN?a.bottom:a.top,q=g(1,4),v=g(5,e/q),0===c.tick()%2&&(b===Heli.Dir.DOWN?a.top+=1:a.bottom+=1));v--;e=b===Heli.Dir.UP?{top:-q,bottom:q}:{top:q,bottom:-q};p.push({top:a.top+e.top,bottom:a.bottom+e.bottom});p.shift()},drawTarget:function(b,a,c){var h=Math.round(0.25*p.length);b.strokeStyle=Heli.Color.TARGET_STROKE;b.beginPath();b.lineWidth=4;b.arc(h*n-10,l(a)+10,50-c,0,2*Math.PI,!1);b.stroke();b.closePath()},toPix:l,init:function(){q=
null;v=0;h=null;r=80;p=[];for(var b=(100-r)/2,b={top:b,bottom:b},a=0;30>a;a+=1)p.push(b)},width:function(){return m},height:function(){return a},collided:function(b){var a=Math.round(0.25*p.length),c=p[a],n=A/2,a=(h===a||h===a-1)&&b<s+n&&b>s-20;return b>100-c.top&&100-c.top||b<c.bottom+n&&c.bottom+n||a}}},Audio:function(c){var l=[],g=[],m=[],a=[];return{disableSound:function(){for(var b=0;b<a.length;b++)l[a[b]].pause(),l[a[b]].currentTime=0;a=[]},load:function(b,a,c){var g=l[b]=document.createElement("audio");
m[b]=function(a){a.loaded===a.total&&"function"===typeof c&&(c(),l[b].removeEventListener("canplaythrough",m[b],!0))};g.addEventListener("canplaythrough",m[b],!0);g.setAttribute("preload","auto");g.setAttribute("autobuffer","true");g.setAttribute("src",a);g.pause()},play:function(b){c.soundDisabled()||(g[b]=function(){var c,m=[],r=!1;l[b].removeEventListener("ended",g[b],!0);for(c=0;c<a.length;c++)!r&&a[c]?r=!0:m.push(a[c]);a=m},a.push(b),l[b].addEventListener("ended",g[b],!0),l[b].play())},stop:function(b){},
pause:function(){for(var b=0;b<a.length;b++)l[a[b]].pause()},resume:function(){for(var b=0;b<a.length;b++)l[a[b]].play()}}}},HELICOPTER=function(){function c(a){a.keyCode===KEY.ENTER&&(z.play("start"),t=!0);a.keyCode===KEY.S?localStorage.soundDisabled=!x():k===Heli.State.WAITING&&a.keyCode===KEY.ENTER?b():k===Heli.State.PLAYING&&a.keyCode===KEY.P?(k=Heli.State.PAUSED,window.clearInterval(e),e=null,n("Paused")):k===Heli.State.PAUSED&&a.keyCode===KEY.P&&(k=Heli.State.PLAYING,e=window.setInterval(r,
1E3/Heli.FPS))}function l(b){b.keyCode===KEY.ENTER&&(t=!1)}function g(a){"CANVAS"===a.target.nodeName&&k===Heli.State.WAITING?(A(),b()):"CANVAS"===a.target.nodeName&&k===Heli.State.BACKGROUND&&s()}function m(b){t=!1}function a(){return y}function b(){k!=Heli.State.PLAYING&&(u.reset(),f.init(),e=window.setInterval(r,1E3/Heli.FPS),k=Heli.State.PLAYING)}function n(b){var a=d.measureText(b).width,a=(f.width()-a)/2,c=f.height()/2-7;d.fillStyle=Heli.Color.DIALOG_TEXT;d.font="14px silkscreen";d.fillText(b,
a,c)}function x(){return"true"===localStorage.soundDisabled}function r(){++y;h();if(k===Heli.State.PLAYING){w=u.move(t);f.moveTerrain();f.draw(d);f.drawTerrain(d);var b=f.collided(w);!1!==b&&(!0!==b&&(w=b),z.play("crash"),k=Heli.State.DYING,B=y,u.finished());f.drawUser(d,w,u.trail(),!0)}else k===Heli.State.DYING&&y-B>Heli.FPS/1?(h(),n("Click to start again."),k=Heli.State.WAITING,window.clearInterval(e),e=null,h()):k===Heli.State.DYING&&(f.draw(d),f.drawTerrain(d),f.drawUser(d,w,u.trail(),!1),f.drawTarget(d,
w,y-B));h()}function h(){d.font="12px silkscreen";var b="Best: "+u.bestDistance()+"m",a="Distance: "+u.distance()+"m";d.measureText(b);f.height();d.fillRect(0,f.height(),f.width(),Heli.FOOTER_HEIGHT);d.fillText(a,20,20);d.fillText(b,20,30)}function q(b,a){if(0===b.length)a();else{var c=b.pop();z.load(c[0],c[1],function(){q(b,a)})}}function v(){h();window.AudioContext=window.AudioContext||window.webkitAudioContext;var b=new AudioContext;analyser=b.createAnalyser();navigator.getUserMedia=navigator.getUserMedia||
navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia?navigator.getUserMedia({video:!1,audio:!0},function(a){b.createMediaStreamSource(a).connect(analyser);k=Heli.State.BACKGROUND;f.draw(d);f.drawTerrain(d);d.fillStyle=Heli.Color.HOME_TEXT;d.font="58px silkscreenbold";a=d.measureText("BE QUIET!").width;a=(f.width()-a)/2;var c=f.height()/3;d.fillText("BE QUIET!",a,c);d.font="14px silkscreen";d.fillText("Click mouse to begin background noise calibration",
a+5,c+66)},function(b){"PERMISSION_DENIED"===b.name&&alert("You must accept audio permissions")}):alert("You must be using Chrome")}function s(){var b=[];f.draw(d);f.drawTerrain(d);d.fillStyle=Heli.Color.HOME_TEXT;d.font="58px silkscreenbold";var a=d.measureText("BE QUIET!").width,a=(f.width()-a)/2,c=f.height()/3;d.fillText("BE QUIET!",a,c);var e=setInterval(function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);a=p(a);b.push(a)},100);setTimeout(function(){clearInterval(e);
for(var a=0,c=0;c<b.length;c++)a+=b[c];backgroundNoise=a/b.length;console.log(backgroundNoise);0==backgroundNoise&&(alert("Your mic is not on"),s());k=Heli.State.WAITING;f.draw(d);f.drawTerrain(d);h();d.fillStyle=Heli.Color.HOME_TEXT;d.font="58px silkscreenbold";a=d.measureText("VoiceCopter").width;a=(f.width()-a)/2;c=f.height()/3;d.fillText("VoiceCopter",a,c);d.font="12px silkscreen";d.fillText("Be loud to fly. Be silent to fall.",a+5,c+20);d.fillText("Click mouse to start",a+5,c+66)},5E3)}function A(){setInterval(function(){var a=
new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);t=50<=3*(p(a)-backgroundNoise)?!0:!1},100)}function p(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=Math.abs(a[d]);return b/c}(function(a,b){for(var c,d=0;d<b.length;d+=1)for(a[b[d].name]={},c=0;c<b[d].consts.length;c+=1)a[b[d].name][b[d].consts[c]]=c})(Heli,Heli.Consts);var k=Heli.State.AUDIODETECT,t=!1,e=null,z=null,f=null,u=null,w=0,B=0,y=0,d;return{init:function(b,e){var h=b.offsetWidth,k=b.offsetHeight;canvas=document.createElement("canvas");
canvas.setAttribute("width",h+"px");canvas.setAttribute("height",k+"px");b.appendChild(canvas);d=canvas.getContext("2d");z=new Heli.Audio({soundDisabled:x});f=new Heli.Screen({tick:a,width:h,height:k});u=new Heli.User({tick:a});f.init();f.draw(d);n("Accept audio request above ^ to begin");"undefined"===typeof localStorage.soundDisabled&&(localStorage.soundDisabled=!0);q([],function(){document.addEventListener("keydown",c,!0);document.addEventListener("keyup",l,!0);document.addEventListener("mousedown",
g,!0);document.addEventListener("mouseup",m,!0);v()})}}}();